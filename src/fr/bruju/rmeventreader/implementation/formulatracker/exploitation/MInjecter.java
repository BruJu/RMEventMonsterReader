package fr.bruju.rmeventreader.implementation.formulatracker.exploitation;

import java.util.stream.Collectors;

import fr.bruju.rmeventreader.implementation.formulatracker.contexte.Attaques;
import fr.bruju.rmeventreader.implementation.formulatracker.formule.condition.Condition;
import fr.bruju.rmeventreader.implementation.formulatracker.formule.formule.FormuleDeDegats;
import fr.bruju.rmeventreader.implementation.formulatracker.formule.valeur.Valeur;
import fr.bruju.rmeventreader.implementation.formulatracker.simplification.injectionvaleur.Injecteur;
import fr.bruju.rmeventreader.implementation.formulatracker.simplification.injectionvaleur.Injection;

public class MInjecter implements Maillon {

	@Override
	public void traiter(Attaques attaques) {
		Injection injection = new Injection();
		injection.remplirAvecFichier("ressources/formulatracker/injection.txt");
		Injecteur injecteur = new Injecteur();

		attaques.apply(formule -> new FormuleDeDegats(formule.getOperator(),
				formule.conditions.stream()
						.map(valeur -> (Condition) injecteur.substituer(injection, valeur))
						.collect(Collectors.toList()),
				(Valeur) injecteur.substituer(injection, formule.getFormule())));
	}

}
