package fr.bruju.rmeventreader.implementation.detectiondeformules.recomposeur.exploitation;

import java.util.HashMap;
import java.util.Map;

import fr.bruju.rmeventreader.implementation.detectiondeformules._personnages.Groupe;
import fr.bruju.rmeventreader.implementation.detectiondeformules._personnages.Individu;
import fr.bruju.rmeventreader.implementation.detectiondeformules._personnages.VariablesAssociees;

public class StatsRecomposition implements VariablesAssociees {
	/** Association nom de la statistique - objet la représentant */
	private final Map<String, Statistique> statistiques;
	/** Association id de variable - nom de la statistique */
	private final Map<Integer, String> nomStatistiquesDesignees;
	
	
	public StatsRecomposition(Individu<StatsRecomposition> individu) {
		statistiques = new HashMap<>();
		nomStatistiquesDesignees = new HashMap<>();
	}
	
	public StatsRecomposition(Groupe<StatsRecomposition> personnageUnifie, BaseDeVariables base) {
		statistiques = new HashMap<>();
		nomStatistiquesDesignees = new HashMap<>();

		personnageUnifie.getIndividus().stream()
				.map(personnageReel -> personnageReel.getVariablesAssociees().statistiques)
				.flatMap(map -> map.values().stream())
				.filter(s -> !nomStatistiquesDesignees.containsKey(s.position))
				.forEach(s -> addStatistique(base.creerStatistique(personnageUnifie, s.nom, s.estPropriete)));
	}
	
	/**
	 * Ajoute une statistique au personnage
	 * 
	 * @param nom Le nom de la statistique
	 * @param position Le numéro de sa variable
	 */
	public void addStatistique(Statistique stat) {
		nomStatistiquesDesignees.put(stat.position, stat.nom);
		statistiques.put(stat.nom, stat);
	}
	
	/**
	 * Donne la statistique portant le nom donné
	 * @param nom Le nom de la statistique
	 * @return L'objet représentant la statistique
	 */
	public Statistique get(String nom) {
		return statistiques.get(nom);
	}
	
	/**
	 * Donne le nom de la statistique désignée par la variable
	 * @param idVariable La variable
	 * @return Le nom de la statistique
	 */
	public String getNomStatistique(int idVariable) {
		return nomStatistiquesDesignees.get(idVariable);
	}
}
